<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="alternate" href="/index.xml" type="application/rss+xml" title="泥土巢">
		<link rel="icon" href="http://nituchao.com/favicon.ico">
		<title>MySQL提供的事务控制语句 - 泥土巢</title>
		
		<link rel="stylesheet" href="http://nituchao.com/css/highlight/atom-one-dark.css">
		<link rel="stylesheet" href="http://nituchao.com/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://nituchao.com/css/bootstrap-theme.min.css">
		<link rel="stylesheet" href="http://nituchao.com/css/theme.css">
		<link rel="stylesheet" href="http://nituchao.com/css/bootie-docs.css">
	</head>

<body role="document">

	
	<nav class="navbar navbar-inverse navbar-fixed-top">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
					<span class="sr-only">Toggle navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="http://nituchao.com/">泥土巢</a>
			</div>
			<div id="navbar" class="navbar-collapse collapse">
				<ul class="nav navbar-nav">
					<li ><a href="http://nituchao.com/">主页</a></li>
			
			
				
					
					<li ><a href="http://nituchao.com/post">文章</a></li>
				
					
					<li ><a href="http://nituchao.com/kk">作品</a></li>
				
					
					<li ><a href="http://nituchao.com/book">书单</a></li>
				
					
					<li ><a href="http://nituchao.com/device">设备</a></li>
				
					
					<li ><a href="http://nituchao.com/te">经济学人</a></li>
				
					
					<li ><a href="http://nituchao.com/about">关于</a></li>
				
			
				
					<li class="dropdown">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">文章分类<span class="caret"></span></a>
						<ul class="dropdown-menu" role="menu">
						
							<li><a href="http://nituchao.com/categories/abc_atomic">Abc_atomic</a></li>
						
							<li><a href="http://nituchao.com/categories/abc_concurrent">Abc_concurrent</a></li>
						
							<li><a href="http://nituchao.com/categories/abc_lock">Abc_lock</a></li>
						
							<li><a href="http://nituchao.com/categories/amqp">Amqp</a></li>
						
							<li><a href="http://nituchao.com/categories/console">Console</a></li>
						
							<li><a href="http://nituchao.com/categories/daily">Daily</a></li>
						
							<li><a href="http://nituchao.com/categories/java">Java</a></li>
						
							<li><a href="http://nituchao.com/categories/jvm">Jvm</a></li>
						
							<li><a href="http://nituchao.com/categories/linux">Linux</a></li>
						
							<li><a href="http://nituchao.com/categories/macos">Macos</a></li>
						
							<li><a href="http://nituchao.com/categories/mysql">Mysql</a></li>
						
							<li><a href="http://nituchao.com/categories/queue">Queue</a></li>
						
							<li><a href="http://nituchao.com/categories/words">Words</a></li>
						
							<li><a href="http://nituchao.com/categories/xa">Xa</a></li>
						
						</ul>
					</li>
				
				</ul>
				
			</div>
		</div>
	</nav>

<div class="container">


<div class="row">
	<div class="col-sm-8 doc-main">
		<main role="main">
			<article>
				<a id="title"></a>
				<h1 class="doc-entry-title">MySQL提供的事务控制语句</h1>
				<div class="doc-entry-meta">
					<span><time datetime="2017-02-14">2017年02月14日</time></span>
				</div>
				<section>
					

<p>在MySQL命令行的默认设置下，事务都是自动提交的，即执行SQL语句后就会马上执行<code>COMMIT</code>操作。因此要显式地开启一个事务需要使用命令<code>BEGIN</code>, <code>START TRANSACTION</code>, 或者执行命令<code>SET AUTOCOMMIT=0</code>, 禁用当前会话的自动提交。</p>

<p>每个数据库厂商自动提交的设置都会不相同，每个DBA或开发人员需要非常明白这一点，这对之后的SQL编程会有非凡的意义，因此用户不能以之前的经验来判断MySQL数据库的运行方式。</p>

<p>MySQL为开发者提供了三种类型的事务，分别是扁平化事务，带保存点的事务，链式事务。通过带保存点的事务还可以模拟实现嵌套事务。</p>

<h3 id="start-transaction-begin">START TRANSACTION | BEGIN</h3>

<p>显式地开启一个事务。</p>

<h3 id="commit">COMMIT</h3>

<p>要想使用这个语句的最简形式，只需要发出<code>COMMIT</code>。也可以更详细一点，写为<code>COMMIT WORK</code>, 不过这两者几乎是等价的。<code>COMMIT</code>会提交事务，并使得已对数据库做的修改称为永久性的。</p>

<h3 id="rollback">ROLLBACK</h3>

<p>要想使用这个语句的最简形式，只需要发出<code>ROLLBACK</code>。同样地，也可以写为<code>ROLLBACK WORK</code>，但两者几乎是等价的。回滚会结束用户的事务，并撤销正在进行的所有未提交的修改。</p>

<h3 id="savepoint-identity">SAVEPOINT identity</h3>

<p><code>SAVEPOINT</code>允许在事务中创建一个保存点，一个事务中可以有多个<code>SAVEPOINT</code>。</p>

<h3 id="release-savepoint-identity">RELEASE SAVEPOINT identity</h3>

<p>删除一个事务的保存点，当没有一个保存点执行这语句时，会抛出一个异常。</p>

<h3 id="rollback-to-savepoint-identity">ROLLBACK TO [SAVEPOINT] identity</h3>

<p>这个语句与<code>SAVEPOINT</code>命令一起使用。可以把事务回滚到标记点，而不回滚在此标记点之前的任何工作。</p>

<p>例如，可以发出两调<code>UPDATE</code>语句，后面跟一个<code>SAVEPOINT</code>, 然后又是两条<code>DELETE</code>语句。如果执行<code>DELETE</code>语句期间出现了某种异常情况，并且捕获到这个异常，同时发出了<code>ROLLBACK TO SAVEPOINT</code>命令，事务就会回滚到指定的SAVEPOINT，撤销<code>DELETE</code>完成的所有工作，而<code>UPDATE</code>语句完成的工作不受影响。</p>

<h3 id="set-transaction">SET TRANSACTION</h3>

<p>这个语句用来设置事务的隔离级别。</p>

<p>InnoDB存储引擎提供的事务隔离级别有：</p>

<ul>
<li>READ UNCOMMITED</li>
<li>READ COMMITTED</li>
<li>REPEATABLE READ</li>
<li>SERIALIZABLE</li>
</ul>

<p><code>START TRANSACTION</code>, <code>BEGIN</code>语句都可以在MySQL命令行下显示地开启一个事务。但是在存储过程中，MySQL数据库的分析器会自动将BEGIN识别为BEGIN&hellip;END, 因此在存储过程中只能使用<code>START TRANSACTION</code>语句来开启一个事务。</p>

<p><code>COMMIT</code>和<code>COMMIT WORK</code>语句基本是一致的，都是用来提交事务。不同之处在于<code>COMMIT WORK</code>用来控制事务结束后的行为是<code>CHAIN</code>还是<code>RELEASE</code>的。如果是<code>CHAIN</code>方式，那么事务就变成了链事务。</p>

<p>用户可以通过参数<code>completion_type</code>来进行控制，该参数默认为0，表示没有任何操作。</p>

<p>当参数<code>completion_type</code>的值为1时，<code>COMMIT WORK</code>等同于<code>COMMIT AND CHAIN</code>, 表示马上自动开启一个相同隔离级别的事务。</p>

<p>当参数<code>completion_type</code>的值为2时，<code>COMMIT WORK</code>等同于<code>COMMIT AND RELEASE</code>, 在事务提交后会自动断开与服务器的连接。</p>

				</section>
			</article>
		</main>
	</div> 

	

<div class="col-sm-3 col-sm-offset-1 doc-sidebar">
	<div id="sidebar">
	<div class="sidebar-module">
		<div class="sidebar-toc">
			<h4 class="sidebar-heading">本文导航</h4>
			<ul>
				<li><strong><a href="#title">MySQL提供的事务控制语句</a></strong></li>
			</ul>
			<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#start-transaction-begin">START TRANSACTION | BEGIN</a></li>
<li><a href="#commit">COMMIT</a></li>
<li><a href="#rollback">ROLLBACK</a></li>
<li><a href="#savepoint-identity">SAVEPOINT identity</a></li>
<li><a href="#release-savepoint-identity">RELEASE SAVEPOINT identity</a></li>
<li><a href="#rollback-to-savepoint-identity">ROLLBACK TO [SAVEPOINT] identity</a></li>
<li><a href="#set-transaction">SET TRANSACTION</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
		</div>
	</div>
	</div>
</div>


</div> 


<hr />

<div class="row">
	<div class="col-sm-8">
		  <p class="doc-footer-em"><a href="#" onclick="resetSidebarPos()">返回顶部</a></p>
	</div>
</div>

</div> 

<footer class="doc-footer">
	<p>Copyright (c) 2017, nituchao | All rights reserved.</p>
	<p>Powered by <strong><a href="https://github.com/key-amb/hugo-theme-bootie-docs">Bootie Docs</a></strong> - theme for <a href="http://gohugo.io/">Hugo</a> by <a href="https://github.com/key-amb/">key-amb</a>.</p>
</footer>



<script src="http://nituchao.com/js/jquery.min.js"></script>
<script src="http://nituchao.com/js/bootstrap.min.js"></script>

<script src="http://nituchao.com/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script src="http://nituchao.com/js/ie10-viewport-bug-workaround.js"></script>
<script src="http://nituchao.com/js/bootie-docs.js"></script>

</body>
</html>


